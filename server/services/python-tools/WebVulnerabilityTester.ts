/**
 * WebVulnerabilityTester - TypeScript Wrapper
 * Auto-generated from offsec-team Python tool
 *
 * A tool for testing applications for common web vulnerabilities.
    Provides capabilities for testing injection vulnerabilities, cross-site vulnerabilities, and authentication security.
 */

import { spawn } from 'child_process';
import path from 'path';

export class WebVulnerabilityTesterWrapper {
  private pythonPath: string;
  private _modulePath: string;

  constructor() {
    this.pythonPath = process.env.PYTHON_PATH || 'python3';
    this._modulePath = path.join(
      process.cwd(),
      './tools/offsec-team/tools/bug_hunter/WebVulnerabilityTester.py'
    );
  }

  /**
   * Execute a Python method with parameters
   */
  private async _executePythonMethod(
    methodName: string,
    params: Record<string, any>
  ): Promise<any> {
    return new Promise((resolve, reject) => {
      const pythonScript = `
import sys
import json
sys.path.append('/home/cmndcntrl/rtpi/tools/offsec-team/tools/bug_hunter')

from WebVulnerabilityTester import WebVulnerabilityTester

# Create instance
tool = WebVulnerabilityTester()

# Call method
result = tool.${methodName}(**json.loads(sys.argv[1]))

# Return result as JSON
print(json.dumps(result))
`;

      const proc = spawn(this.pythonPath, ['-c', pythonScript, JSON.stringify(params)], {
        stdio: 'pipe',
      });

      let output = '';
      let errorOutput = '';

      proc.stdout.on('data', (data) => {
        output += data.toString();
      });

      proc.stderr.on('data', (data) => {
        errorOutput += data.toString();
      });

      proc.on('close', (code) => {
        if (code === 0) {
          try {
            const result = JSON.parse(output);
            resolve(result);
          } catch (error) {
            reject(new Error(`Failed to parse output: ${output}`));
          }
        } else {
          reject(new Error(`Python execution failed: ${errorOutput || output}`));
        }
      });

      proc.on('error', (error) => {
        reject(error);
      });
    });
  }


}

/**
 * Create a new instance of the tool
 */
export function createWebVulnerabilityTester(): WebVulnerabilityTesterWrapper {
  return new WebVulnerabilityTesterWrapper();
}
